# This is a basic workflow to help you get started with Actions

name: workspace deployment
on:
    push:
        branches: [ publish_branch ]
    workflow_dispatch:
      inputs:
        resourceGroupName:
          description: 'Synapse resource group name'
          required: true
        SynapseWorkspaceName:
          description: 'Synapse Workspace name'
          required: true
        armTemplateFile:
          description: 'ARM template file name'
          required: false
          default: 'TemplateForWorkspace.json'
        armTemplateParametersFile:
          description: 'ARM template parameters file name'
          required: false
          default: 'TemplateParametersForWorkspace.json'
        additionalParameters:
          description: 'Parameters which will be replaced in the ARM template'
          required: false
          default: ''
        skipAzModuleInstallation:
          description: 'Parameters which skip the Az module installation'
          required: false
          default: 'false'
jobs:
  release:
        # You also can use the self-hosted runners.
    runs-on: windows-latest
    steps:
        # Checks out your repository under $GITHUB_WORKSPACE, so your job can access it.
    - uses: actions/checkout@v2
    - uses: azure/synapse-workspace-deployment@release-1.0
      with:
          TargetWorkspaceName: ${{ github.event.inputs.SynapseWorkspaceName }}
          TemplateFile: ./workspace_publish/dcucereavii/${{ inputs.armTemplateFile }}
          ParametersFile: /workspace_publish/dcucereavii/${{ inputs.armTemplateParametersFile }}
          OverrideArmParameters: ''
          environment: 'Azure Public'
          resourceGroup: ${{ github.event.inputs.resourceGroupName }}
          clientId: ${{secrets.CLIENTID}}
          clientSecret:  ${{secrets.CLIENTSECRET}}
          subscriptionId: ${{ secrets.SUBSCRIPTION_ID }}
          tenantId: ${{ secrets.TENANT_ID }}
          DeleteArtifactsNotInTemplate: 'true'
          managedIdentity: 'False'


    
    
